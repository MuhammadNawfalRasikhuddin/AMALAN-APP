<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AMANAH - Ultimate & News System</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet" />
    <style>
      :root {
        --primary: #059669;
        --bg: #f8fafc;
        --text: #111827;
        --sub: #6b7280;
        --border: #e2e8f0;
        --accent: #10b981;
        --verify: #1d9bf0;
        --white: #ffffff;
      }
      * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Plus Jakarta Sans", sans-serif; }
      body { background-color: var(--bg); color: var(--text); }
      header { position: sticky; top: 0; z-index: 100; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(15px); border-bottom: 1px solid var(--border); padding: 12px 5%; display: flex; justify-content: space-between; align-items: center; }
      .logo { font-weight: 800; font-size: 1.4rem; color: var(--primary); cursor: pointer; }
      .nav-tools { display: flex; gap: 10px; align-items: center; }
      .search-input { padding: 8px 15px; border-radius: 99px; border: 1px solid var(--border); outline: none; width: 150px; transition: 0.3s; }
      .search-input:focus { width: 200px; border-color: var(--primary); }
      .btn { border: none; padding: 10px 18px; border-radius: 12px; font-weight: 700; cursor: pointer; transition: 0.2s; font-size: 0.85rem; }
      .btn-p { background: var(--primary); color: white; }
      .btn-lang { background: #f1f5f9; border: 1px solid var(--border); }
      .container { max-width: 850px; margin: 0 auto; padding: 30px 20px; }
      .page { display: none; animation: fadeIn 0.4s ease; }
      .page.active { display: block; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-top: 25px; }
      .m-card { background: var(--white); border: 1px solid var(--border); padding: 25px; border-radius: 20px; cursor: pointer; transition: 0.3s; }
      .m-card:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
      .news-highlight { margin-top: 40px; }
      .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
      .news-card { background: white; border-radius: 20px; border: 1px solid var(--border); overflow: hidden; cursor: pointer; transition: 0.3s; height: 100%; }
      .news-card:hover { transform: translateY(-5px); border-color: var(--primary); }
      .news-card img { width: 100%; height: 160px; object-fit: cover; }
      .news-info { padding: 15px; }
      .news-tag { font-size: 0.65rem; font-weight: 800; color: var(--primary); text-transform: uppercase; }
      .news-title { font-size: 1rem; font-weight: 700; margin: 5px 0; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
      .load-more-container { text-align: center; margin-top: 30px; padding-bottom: 50px; }
      .btn-load { background: #f1f5f9; color: var(--primary); border: 1px solid var(--border); padding: 12px 30px; border-radius: 12px; font-weight: 700; cursor: pointer; transition: 0.3s; }
      .btn-load:hover { background: var(--primary); color: white; }
      .q-box { background: var(--white); border-radius: 20px; border: 1px solid var(--border); overflow: hidden; }
      .q-row { display: flex; align-items: center; gap: 15px; padding: 15px; border-bottom: 1px solid var(--border); cursor: pointer; }
      .q-row:hover { background: #f9fafb; }
    </style>
  </head>
  <body>
    <header id="navbar" style="display: none">
      <div class="logo" onclick="navigateTo('dashboard')">AMANAH.</div>
      <div class="nav-tools">
        <input type="text" class="search-input" id="search-box" placeholder="Cari misi..." />
        <button class="btn btn-lang" id="lang-btn" onclick="toggleLanguage()">üåê ID</button>
        <button class="btn btn-p" style="background: #ef4444" onclick="location.reload()">Logout</button>
      </div>
    </header>

    <div class="container">
      <section id="page-login" class="page active" style="text-align: center; padding-top: 20vh">
        <h1 style="font-size: 3rem; font-weight: 800; color: var(--primary); letter-spacing: -2px;">AMANAH.</h1>
        <p id="txt-sub">Sistem Integritas & Kabar Muslim Modern</p>
        <br />
        <input type="text" id="user-name" placeholder="Nama Anda" style="padding: 15px; width: 100%; max-width: 320px; border-radius: 15px; border: 1px solid var(--border); outline: none;" />
        <br /><br />
        <button class="btn btn-p" id="txt-btn-login" style="padding: 15px 50px" onclick="login()">Masuk</button>
      </section>

      <section id="page-dashboard" class="page">
        <h2 id="txt-hi" style="font-size: 1.8rem; margin-bottom: 25px">Selamat Datang</h2>
        <div class="grid">
          <div class="m-card" onclick="navigateTo('misi-list')">
            <h3 id="txt-m1">üõ°Ô∏è Vault 8 Pilar</h3>
            <p style="color: var(--sub); font-size: 0.8rem; margin-top: 5px">Checklist 64 poin integritas harian.</p>
          </div>
          <div class="m-card" onclick="navigateTo('forum')">
            <h3 id="txt-m2">üí¨ Forum Mentor</h3>
            <p style="color: var(--sub); font-size: 0.8rem; margin-top: 5px">Tanya jawab ustadz & diskusi.</p>
          </div>
          <div class="m-card" onclick="navigateTo('score')">
            <h3 id="txt-m3">üìä Raport Integritas</h3>
            <p style="color: var(--sub); font-size: 0.8rem; margin-top: 5px">Lihat Grade A-D Anda.</p>
          </div>
        </div>

        <div class="news-highlight">
          <h3 id="txt-news-head">Kabar Muslim Terkini</h3>
          <div class="news-grid" id="news-feed-dashboard">
            <p style="text-align: center; color: var(--sub);">Memuat berita...</p>
          </div>
          <div class="load-more-container">
            <button id="btn-load-more" class="btn-load" onclick="loadMoreNews()" style="display: none;">Tampilkan Lebih Banyak</button>
          </div>
        </div>
      </section>

      <section id="page-news-detail" class="page">
        <button class="btn btn-lang" onclick="handleBack()">‚Üê Kembali</button>
        <div id="news-content-area" style="margin-top: 20px"></div>
      </section>

      <section id="page-misi-list" class="page">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 id="txt-misi-head">8 Pilar Utama</h2>
          <button class="btn btn-lang" onclick="handleBack()">‚Üê Kembali</button>
        </div>
        <div class="grid" id="misi-grid-container"></div>
      </section>

      <section id="page-quest" class="page">
        <button class="btn btn-lang" onclick="handleBack()">‚Üê Kembali</button>
        <h2 id="active-misi-title" style="margin: 20px 0">Detail Misi</h2>
        <div class="q-box" id="quest-container"></div>
        <button class="btn btn-p" id="txt-btn-save" style="width: 100%; margin-top: 20px; padding: 18px" onclick="saveQuest()">Simpan Progress</button>
      </section>

      <section id="page-score" class="page" style="text-align: center">
        <div class="m-card" style="max-width: 400px; margin: 0 auto; padding: 50px">
          <h2 id="txt-grade-title">Grade Anda</h2>
          <div id="final-grade" style="font-size: 6rem; font-weight: 800; color: var(--primary)">-</div>
          <h3 id="final-percent">0%</h3>
          <button class="btn btn-p" style="margin-top: 20px" onclick="handleBack()">Kembali</button>
        </div>
      </section>

      <section id="page-forum" class="page">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2>üí¨ Forum Diskusi</h2>
          <button class="btn btn-lang" onclick="handleBack()">‚Üê Kembali</button>
        </div>
        <div class="m-card" style="margin-bottom: 15px">
          <p><strong>@Ustadz_Ahmad:</strong> "Pentingnya menjaga amanah dalam transaksi digital..."</p>
        </div>
        <div class="m-card">
          <p>Fitur diskusi interaktif segera hadir pada update berikutnya.</p>
        </div>
      </section>
    </div>

    <script>
      // GANTI LINK DI BAWAH INI DENGAN LINK RENDER KAMU
      const API_URL = "https://amalan-app.onrender.com"; 

      let allNews = [];
      let visibleCount = 3; 
      let user = "";
      let currentLang = "ID";
      let progress = {};
      let activeId = null;

      const mDb = [
        { id: 1, title: "Kejujuran Lisan", icon: "‚öñÔ∏è", q: ["Tidak bohong", "Akui salah", "No Hoax", "Sesuai fakta", "Jujur niat", "Tak melebihkan", "Bicara benar", "Berani jujur"] },
        { id: 2, title: "Amanah Harta", icon: "üí∞", q: ["No suap", "Zakat rutin", "Timbangan pas", "Cacat barang disebut", "No korupsi waktu", "Gaji halal", "Sedekah", "Catat hutang"] },
        { id: 3, title: "Janji & Komitmen", icon: "ü§ù", q: ["Tepat waktu", "No ingkar", "Deadline aman", "Hutang lunas", "Akad jelas", "Rahasia aman", "Konsisten", "Tanggung jawab"] },
        { id: 4, title: "Adab Digital", icon: "üì±", q: ["No bully", "Komen sopan", "Filter konten", "No ghibah", "Izin tag", "Jaga privasi", "Share manfaat", "Bijak sosmed"] },
        { id: 5, title: "Tanggung Jawab Kerja", icon: "üíº", q: ["Datang tepat waktu", "Selesaikan tugas", "No curi waktu", "Rawat fasilitas", "Komunikasi jelas", "Hormati rekan", "Disiplin", "Profesional"] },
        { id: 6, title: "Integritas Ilmu", icon: "üìö", q: ["No plagiat", "Sebut sumber", "Ngajar jujur", "Terus belajar", "Bagi manfaat", "Adab ke guru", "Sabar", "Ikhlas"] },
        { id: 7, title: "Kepedulian Sosial", icon: "üåç", q: ["Bantu tetangga", "Jaga lingkungan", "Ramah", "No ghibah", "Empati", "Zakat maal", "Gotong royong", "Adil"] },
        { id: 8, title: "Kesehatan Amanah", icon: "‚ù§Ô∏è", q: ["Makan halal", "Istirahat cukup", "Olahraga", "No rokok/narkoba", "Jaga mental", "Syukur", "Kebersihan", "Sabar"] }
      ];

      const lang = {
        ID: { sub: "Sistem Integritas & Kabar Muslim Modern", btnLogin: "Masuk", hi: "Selamat Datang", newsHead: "Kabar Muslim Terkini", misiHead: "8 Pilar Utama", btnSave: "Simpan Progress", gradeTitle: "Grade Anda" },
        EN: { sub: "Modern Digital Integrity & News System", btnLogin: "Login", hi: "Welcome", newsHead: "Latest Muslim News", misiHead: "8 Main Pillars", btnSave: "Save Progress", gradeTitle: "Your Grade" }
      };

      function login() {
        user = document.getElementById("user-name").value;
        if (!user) return alert("Masukkan nama!");
        document.getElementById("navbar").style.display = "flex";
        updateUI();
        navigateTo("dashboard");
      }

      function navigateTo(p) {
        window.history.pushState({ page: p }, "", "#" + p);
        show(p);
      }

      function show(p) {
        document.querySelectorAll(".page").forEach((pg) => pg.classList.remove("active"));
        const target = document.getElementById("page-" + p);
        if(target) target.classList.add("active");
        
        if (p === "dashboard") fetchNews();
        if (p === "misi-list") renderMisi();
        if (p === "score") calcScore();
        window.scrollTo(0, 0);
      }

      async function fetchNews() {
        if (allNews.length > 0) return;
        const feedContainer = document.getElementById("news-feed-dashboard");
        try {
          const res = await fetch(`${API_URL}/news`);
          allNews = await res.json();
          renderNews();
        } catch (e) {
          feedContainer.innerHTML = `<p style="text-align:center; grid-column:1/-1;">Gagal memuat berita. Periksa link API.</p>`;
        }
      }

      function renderNews() {
        const container = document.getElementById("news-feed-dashboard");
        const currentItems = allNews.slice(0, visibleCount);
        
        container.innerHTML = currentItems.map((n) => `
            <div class="news-card" onclick="openNewsDetail(${n.id})">
                <img src="${n.image}" alt="news">
                <div class="news-info">
                    <span class="news-tag">${n.category}</span>
                    <div class="news-title">${n.title}</div>
                    <p style="font-size:0.75rem; color:var(--sub)">${n.summary}</p>
                </div>
            </div>
        `).join("");

        const loadMoreBtn = document.getElementById("btn-load-more");
        if (visibleCount >= allNews.length) {
            loadMoreBtn.style.display = "none";
        } else {
            loadMoreBtn.style.display = "inline-block";
        }
      }

      function loadMoreNews() {
        visibleCount += 3; 
        renderNews();
      }

      function openNewsDetail(id) {
        const n = allNews.find((x) => x.id === id);
        if(!n) return;
        document.getElementById("news-content-area").innerHTML = `
            <img src="${n.image}" style="width:100%; border-radius:20px; max-height:400px; object-fit:cover;">
            <h1 style="margin:20px 0; font-size:1.5rem;">${n.title}</h1>
            <p style="line-height:1.8; color:#374151;">${n.content}</p>
            <br><hr><br>
            <a href="${n.link}" target="_blank" class="btn btn-p" style="text-decoration:none; display:inline-block;">Baca Sumber Asli</a>
        `;
        navigateTo("news-detail");
      }

      function renderMisi() {
        const container = document.getElementById("misi-grid-container");
        container.innerHTML = mDb.map((m) => `
            <div class="m-card" onclick="openQuest(${m.id})">
                <h3>${m.icon} ${m.title}</h3>
                <p>${progress[m.id] || 0}/${m.q.length} Selesai</p>
            </div>
        `).join("");
      }

      function openQuest(id) {
        activeId = id;
        const m = mDb.find((x) => x.id === id);
        document.getElementById("active-misi-title").innerText = m.title;
        document.getElementById("quest-container").innerHTML = m.q.map((q) => `
            <div class="q-row" onclick="const ck = this.querySelector('input'); ck.checked = !ck.checked;">
                <input type="checkbox" class="q-chk" onclick="event.stopPropagation()"> 
                <span>${q}</span>
            </div>
        `).join("");
        navigateTo("quest");
      }

      function saveQuest() {
        progress[activeId] = document.querySelectorAll(".q-chk:checked").length;
        alert("Progres disimpan!");
        handleBack();
      }

      function calcScore() {
        let achieved = 0, possible = 0;
        mDb.forEach(m => { achieved += (progress[m.id] || 0); possible += m.q.length; });
        const percent = Math.round((achieved / possible) * 100);
        document.getElementById("final-percent").innerText = percent + "%";
        const gradeBox = document.getElementById("final-grade");
        if (percent >= 90) gradeBox.innerText = "A";
        else if (percent >= 70) gradeBox.innerText = "B";
        else if (percent >= 40) gradeBox.innerText = "C";
        else gradeBox.innerText = "D";
      }

      function toggleLanguage() {
        currentLang = currentLang === "ID" ? "EN" : "ID";
        document.getElementById("lang-btn").innerText = "üåê " + currentLang;
        updateUI();
      }

      function updateUI() {
        const t = lang[currentLang];
        document.getElementById("txt-sub").innerText = t.sub;
        document.getElementById("txt-btn-login").innerText = t.btnLogin;
        document.getElementById("txt-hi").innerText = t.hi + (user ? ", " + user : "");
        document.getElementById("txt-news-head").innerText = t.newsHead;
        document.getElementById("txt-misi-head").innerText = t.misiHead;
        document.getElementById("txt-btn-save").innerText = t.btnSave;
        document.getElementById("txt-grade-title").innerText = t.gradeTitle;
      }

      window.onpopstate = (e) => { if (e.state) show(e.state.page); };
      function handleBack() { window.history.back(); }
    </script>
  </body>
</html>